name: Main Workflow
on: 
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

env:
  PYTHON_VERSION: "3.10"
  DEPENDENCY_MANAGER: "poetry"
  ENABLE_BLACK: true

jobs:

  code-quality:
    name: Code Quality
    runs-on: ubuntu-latest
    steps:

      - name: Check out Git repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: ${{ env.PYTHON_VERSION }}
          architecture: "x64"

      - name: Install Python Dependencies - Poetry
        if: ${{ env.DEPENDENCY_MANAGER == 'poetry' }}
        uses: ./.github/actions/poetry-setup

      - name: Install Python Dependencies - Pip
        if: ${{ env.DEPENDENCY_MANAGER == 'pip' }}
        uses: ./.github/actions/pip-setup

      - name: Verify Code Style (Black)
        if: ${{ env.ENABLE_BLACK == 'true' }}
        run: |
          source .venv/bin/activate
          black --check --verbose .
